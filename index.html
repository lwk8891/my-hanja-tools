
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í•œì íŒŒìƒ êµ¬ì¡° ì…ë ¥ê¸° (ìë™ ì±„ì›€ + ê²€ìƒ‰)</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea, input, select { width: 100%; margin: 5px 0 15px; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    #output { white-space: pre; background: #f0f0f0; padding: 10px; border: 1px solid #ccc; }
    button { padding: 8px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>í•œì íŒŒìƒ êµ¬ì¡° ì…ë ¥ê¸° (ìë™ ì±„ì›€ + ê²€ìƒ‰)</h1>

  <label>í•œì ì½”ë“œ (ì˜ˆ: å¯…)</label>
  <input type="text" id="key" onblur="autofillFromEumun()" />

  <label>í‘œì‹œìš© í‘œê¸° (ë¸ŒëŸ°ì¹˜ìš©)</label>
  <input type="text" id="display" />

  <label>ëœ»</label>
  <input type="text" id="meaning" />

  <label>í›ˆìŒ</label>
  <input type="text" id="labelText" />

  <label>ì¶”ê°€ í›ˆìŒ</label>
  <input type="text" id="extraLabels" />

  <label>ì˜ˆì‹œ</label>
  <input type="text" id="examples" />

  <label>ë¹„ê³ </label>
  <input type="text" id="note" />

  <label>ê¸‰ìˆ˜</label>
  <select id="level">
    <option value="">(ì„ íƒ)</option>
    <option>ì–´ë¬¸íšŒ 8ê¸‰</option>
    <option>ì–´ë¬¸íšŒ ì¤€7ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 7ê¸‰</option>
    <option>ì–´ë¬¸íšŒ ì¤€6ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 6ê¸‰</option>
    <option>ì–´ë¬¸íšŒ ì¤€5ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 5ê¸‰</option>
    <option>ì–´ë¬¸íšŒ ì¤€4ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 4ê¸‰</option>
    <option>ì–´ë¬¸íšŒ ì¤€3ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 3ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 2ê¸‰</option>
    <option>ì–´ë¬¸íšŒ 1ê¸‰</option>
    <option>ì–´ë¬¸íšŒ ì¤€íŠ¹ê¸‰</option>
    <option>ì–´ë¬¸íšŒ íŠ¹ê¸‰</option>
    <option>ê¸‰ìˆ˜ ì™¸</option>
  </select>

  <label>ë¶€ìˆ˜</label>
  <input type="text" id="radical" />

  <label>êµ¬ì„±ìš”ì†Œ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
  <input type="text" id="components" />

  <label>íŒŒìƒëœ ìƒìœ„ í•œì (ì„ íƒ ë˜ëŠ” ìˆ˜ë™ì…ë ¥)</label>
  <select id="parentSelect">
    <option value="">(ì„ íƒ)</option>
  </select>
  <input type="text" id="parentManual" placeholder="ë˜ëŠ” ìˆ˜ë™ ì…ë ¥ (ì˜ˆ: å¯…)" />

  <button onclick="addEntry()">ì¶”ê°€</button>
  <button onclick="downloadJSON()">JSON ì €ì¥</button>
  <button onclick="triggerImport()">JSON ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <input type="file" id="jsonFileInput" style="display:none" accept=".json" />

  <h2>ìë™ ê²€ìƒ‰ ë§í¬</h2>
  <div id="searchLinks" style="margin: 10px 0; padding: 10px; background: #eef; border: 1px solid #ccc;"></div>

  <h2>í˜„ì¬ ë°ì´í„°</h2>
  <div id="output">{}</div>

  <script>
    const data = {};
    const eumunData = {};

    function generateSearchLinks(char) {
      const encoded = encodeURIComponent(char);
      const hex = char.codePointAt(0).toString(16).toUpperCase();
      return `
        ğŸ”— <a href="https://hanja.dict.naver.com/hanja?q=${encoded}" target="_blank">ë„¤ì´ë²„ í•œìì‚¬ì „</a><br/>
        ğŸ”— <a href="https://en.wiktionary.org/wiki/${encoded}" target="_blank">ì˜ë¬¸ Wiktionary</a><br/>
        ğŸ”— <a href="https://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=${hex}" target="_blank">Unihan Database</a><br/>
        ğŸ”— <a href="https://xiaoxue.iis.sinica.edu.tw/?char=${encoded}" target="_blank">å°å­¸å ‚</a><br/>
        ğŸ”— <a href="https://ctext.org/dictionary.pl?if=en&char=${encoded}" target="_blank">ctext.org ì‚¬ì „</a><br/>
        ğŸ”— <a href="#" onclick="openStdDictHanjaSearch('${char}'); return false;">í‘œì¤€êµ­ì–´ëŒ€ì‚¬ì „(í•œì í¬í•¨)</a>
      `;
    }

    function openStdDictHanjaSearch(char) {
      const form = document.createElement("form");
      form.method = "POST";
      form.action = "https://stdict.korean.go.kr/search/searchDetailWords.do";
      form.target = "_blank";
    
      const addHidden = (name, value) => {
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = name;
        input.value = value;
        form.appendChild(input);
      };
    
      addHidden("searchTargets", "ORG_LANGUAGE");    // ì›ì–´(í•œì)
      addHidden("searchKeywords", char);            // ê²€ìƒ‰ì–´
      addHidden("searchConditions", "all");         // í¬í•¨ ê²€ìƒ‰
      addHidden("searchBoxFlag", "Y");
      addHidden("searchType", "1");                 // ë‹¨ì–´
      addHidden("searchKeywordTo", "3");
    
      addHidden("searchWordKind_all", "-1");        // ê³ ìœ ì–´/í•œìì–´ êµ¬ë¶„ ì•ˆí•¨
      addHidden("_searchWordKind_all", "on");
    
      addHidden("searchWordKindCode_all", "-1");
      addHidden("_searchWordKindCode_all", "on");
    
      addHidden("pageSize", "10");
    
      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
    }


    function autofillFromEumun() {
      const key = document.getElementById("key").value.trim();
      const info = eumunData[key];
      if (info) {
        document.getElementById("meaning").value = info.meaning;
        document.getElementById("labelText").value = info.label;
        document.getElementById("extraLabels").value = (info.extra_labels || []).join(" | ");
        document.getElementById("radical").value = info.radical;
        document.getElementById("level").value = info.level;
      }
      if (key) {
        document.getElementById("searchLinks").innerHTML = generateSearchLinks(key);
      } else {
        document.getElementById("searchLinks").innerHTML = "";
      }
    }

    function addEntry() {
      const key = document.getElementById("key").value.trim();
      if (!key) return alert("í•œì ì½”ë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");

      const entry = {
        display: document.getElementById("display").value.trim() || key,
        meaning: document.getElementById("meaning").value.trim(),
        label: document.getElementById("labelText").value.trim(),
        extra_labels: document.getElementById("extraLabels").value.split("|").map(x => x.trim()).filter(Boolean),
        examples: document.getElementById("examples").value.trim(),
        note: document.getElementById("note").value.trim(),
        level: document.getElementById("level").value,
        radical: document.getElementById("radical").value.trim(),
        components: document.getElementById("components").value.split(",").map(x => x.trim()).filter(Boolean),
        children: data[key]?.children || []
      };

      data[key] = entry;

      const parentSelect = document.getElementById("parentSelect");
      const parentManual = document.getElementById("parentManual").value.trim();
      const parentKey = parentManual || parentSelect.value;

      if (parentKey) {
        if (!data[parentKey]) {
          data[parentKey] = {
            display: parentKey,
            meaning: "",
            label: "",
            examples: "",
            note: "",
            level: "",
            radical: "",
            components: [],
            extra_labels: [],
            children: []
          };
        }
        if (!data[parentKey].children.includes(key)) {
          data[parentKey].children.push(key);
        }
      }

      updateParentSelect();
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    }

    function updateParentSelect() {
      const select = document.getElementById("parentSelect");
      const current = select.value;
      select.innerHTML = '<option value="">(ì„ íƒ)</option>';
      Object.keys(data).forEach(k => {
        const option = document.createElement("option");
        option.value = k;
        option.textContent = k;
        select.appendChild(option);
      });
      select.value = current;
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "hanja_data.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function triggerImport() {
      document.getElementById("jsonFileInput").click();
    }

    document.getElementById("jsonFileInput").addEventListener("change", function(evt) {
      const file = evt.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          for (const [key, value] of Object.entries(imported)) {
            if (!data[key]) {
              data[key] = value;
            } else {
              Object.assign(data[key], value);
            }
          }
          updateParentSelect();
          document.getElementById("output").textContent = JSON.stringify(data, null, 2);
          alert("ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!");
        } catch (err) {
          alert("JSON í˜•ì‹ ì˜¤ë¥˜: " + err.message);
        }
      };
      reader.readAsText(file);
    });

    fetch("eumun_hanja_data_fixed.json")
      .then(res => res.json())
      .then(json => {
        Object.assign(eumunData, json);
      });
  </script>
</body>
</html>
